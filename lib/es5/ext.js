"use strict";
"use strict";
var Bluebird = require("bluebird");
var _ = require("lodash");
function synchronify(fire, f) {
  return function() {
    var err;
    var res;
    var cb = function(e, r) {
      err = e;
      res = r;
      done = true;
    };
    var done = false;
    var args = _.toArray(arguments).concat(cb);
    f.apply(this, args);
    while (!done)
      fire._doEvents();
    if (err)
      throw err;
    return res;
  };
}
function installAsyncAndSync(fire, obj, name) {
  if (_.isUndefined(name)) {
    var $__3 = true;
    var $__4 = false;
    var $__5 = undefined;
    try {
      for (var $__1 = void 0,
          $__0 = (_.keys(obj))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
        var key = $__1.value;
        {
          installAsyncAndSync(fire, obj, key);
        }
      }
    } catch ($__6) {
      $__4 = true;
      $__5 = $__6;
    } finally {
      try {
        if (!$__3 && $__0.return != null) {
          $__0.return();
        }
      } finally {
        if ($__4) {
          throw $__5;
        }
      }
    }
    return;
  }
  var f = obj[name];
  if (_.isFunction(f)) {
    if (!_.isFunction(obj[name + "Async"])) {
      obj[name + "Async"] = function() {
        var self = this;
        var args = _.toArray(arguments);
        return new Bluebird(function(resolve, reject) {
          var cb = function(e, r) {
            if (e) {
              reject(e);
            } else {
              resolve(r);
            }
          };
          args.push(cb);
          f.apply(self, args);
        });
      };
    }
    obj[name + "Sync"] = synchronify(fire, f);
  }
}
function Ext(self) {
  installAsyncAndSync(self, self);
  installAsyncAndSync(self, self.AFArray);
  installAsyncAndSync(self, self.AFArray.prototype);
  self.types = {
    dtype: require("./dtype"),
    dDype: require("./dtype"),
    source: require("./source")
  };
  self.Dim4 = require("./dim4");
  self.Seq = require("./seq");
  self.Complex = require("./complex");
  self.getDevices = function() {
    var current = self.getDevice();
    try {
      var count = self.getDeviceCount();
      var result = [];
      for (var i = 0; i < count; i++) {
        self.setDevice(i);
        var info = self.deviceInfo();
        info.id = i;
        result.push(info);
      }
      return result;
    } finally {
      self.setDevice(current);
    }
  };
}
module.exports = Ext;
//# sourceMappingURL=data:application/json;base64,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c291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUgR++/vWJvciBNZXrvv70gYWthIHVuYm9ybmNoaWtrZW4gKGdhYm9yLm1lem9Ab3V0bG9vay5jb20pXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmxldCBCbHVlYmlyZCA9IHJlcXVpcmUoXCJibHVlYmlyZFwiKTtcbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcblxuZnVuY3Rpb24gc3luY2hyb25pZnkgKGZpcmUsIGYpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXJyO1xuICAgICAgICB2YXIgcmVzO1xuICAgICAgICBsZXQgY2IgPSBmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICAgICAgZXJyID0gZTtcbiAgICAgICAgICAgIHJlcyA9IHI7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgICAgICBsZXQgYXJncyA9IF8udG9BcnJheShhcmd1bWVudHMpLmNvbmNhdChjYik7XG5cbiAgICAgICAgZi5hcHBseSh0aGlzLCBhcmdzKTtcblxuICAgICAgICB3aGlsZSAoIWRvbmUpIGZpcmUuX2RvRXZlbnRzKCk7XG5cbiAgICAgICAgaWYgKGVycikgdGhyb3cgZXJyO1xuXG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpbnN0YWxsQXN5bmNBbmRTeW5jIChmaXJlLCBvYmosIG5hbWUpIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChuYW1lKSkge1xuICAgICAgICBmb3IgKGxldCBrZXkgb2YgXy5rZXlzKG9iaikpIHtcbiAgICAgICAgICAgIGluc3RhbGxBc3luY0FuZFN5bmMoZmlyZSwgb2JqLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZiA9IG9ialtuYW1lXTtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKGYpKSB7XG4gICAgICAgIGlmICghXy5pc0Z1bmN0aW9uKG9ialtuYW1lICsgXCJBc3luY1wiXSkpIHtcbiAgICAgICAgICAgIG9ialtuYW1lICsgXCJBc3luY1wiXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgbGV0IGFyZ3MgPSBfLnRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsdWViaXJkKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNiID0gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGNiKTtcbiAgICAgICAgICAgICAgICAgICAgZi5hcHBseShzZWxmLCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgb2JqW25hbWUgKyBcIlN5bmNcIl0gPSBzeW5jaHJvbmlmeShmaXJlLCBmKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIEV4dCAoc2VsZikge1xuXG4gICAgaW5zdGFsbEFzeW5jQW5kU3luYyhzZWxmLCBzZWxmKTtcbiAgICBpbnN0YWxsQXN5bmNBbmRTeW5jKHNlbGYsIHNlbGYuQUZBcnJheSk7XG4gICAgaW5zdGFsbEFzeW5jQW5kU3luYyhzZWxmLCBzZWxmLkFGQXJyYXkucHJvdG90eXBlKTtcblxuICAgIHNlbGYudHlwZXMgPSB7XG4gICAgICAgIGR0eXBlOiByZXF1aXJlKFwiLi9kdHlwZVwiKSxcbiAgICAgICAgZER5cGU6IHJlcXVpcmUoXCIuL2R0eXBlXCIpLFxuICAgICAgICBzb3VyY2U6IHJlcXVpcmUoXCIuL3NvdXJjZVwiKVxuICAgIH07XG5cbiAgICBzZWxmLkRpbTQgPSByZXF1aXJlKFwiLi9kaW00XCIpO1xuXG4gICAgc2VsZi5TZXEgPSByZXF1aXJlKFwiLi9zZXFcIik7XG5cbiAgICBzZWxmLkNvbXBsZXggPSByZXF1aXJlKFwiLi9jb21wbGV4XCIpO1xuXG4gICAgc2VsZi5nZXREZXZpY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgY3VycmVudCA9IHNlbGYuZ2V0RGV2aWNlKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgY291bnQgPSBzZWxmLmdldERldmljZUNvdW50KCk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICBzZWxmLnNldERldmljZShpKTtcbiAgICAgICAgICAgICAgICBsZXQgaW5mbyA9IHNlbGYuZGV2aWNlSW5mbygpO1xuICAgICAgICAgICAgICAgIGluZm8uaWQgPSBpO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHNlbGYuc2V0RGV2aWNlKGN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFeHQ7Il19
