"use strict";
"use strict";
var Bluebird = require("bluebird");
var _ = require("lodash");
function synchronify(fire, f) {
  return function() {
    var err;
    var res;
    var done = false;
    var cb = function(e, r) {
      err = e;
      res = r;
      done = true;
    };
    var args = _.toArray(arguments).concat(cb);
    f.apply(this, args);
    while (!done)
      fire._doEvents();
    if (err)
      throw err;
    return res;
  };
}
function installAsyncAndSync(fire, obj, name) {
  if (_.isUndefined(name)) {
    var $__3 = true;
    var $__4 = false;
    var $__5 = undefined;
    try {
      for (var $__1 = void 0,
          $__0 = (_.keys(obj))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
        var key = $__1.value;
        {
          installAsyncAndSync(fire, obj, key);
        }
      }
    } catch ($__6) {
      $__4 = true;
      $__5 = $__6;
    } finally {
      try {
        if (!$__3 && $__0.return != null) {
          $__0.return();
        }
      } finally {
        if ($__4) {
          throw $__5;
        }
      }
    }
    return;
  }
  var f = obj[name];
  if (_.isFunction(f)) {
    if (!_.isFunction(obj[name + "Async"])) {
      obj[name + "Async"] = function() {
        var self = this;
        var args = _.toArray(arguments);
        return new Bluebird(function(resolve, reject) {
          var cb = function(e, r) {
            if (e) {
              reject(e);
            } else {
              resolve(r);
            }
          };
          args.push(cb);
          f.apply(self, args);
        });
      };
    }
    obj[name + "Sync"] = synchronify(fire, f);
  }
}
function Ext(self) {
  installAsyncAndSync(self, self);
  installAsyncAndSync(self, self.AFArray);
  installAsyncAndSync(self, self.AFArray.prototype);
  _.extend(self, {
    end: -1,
    span: null,
    all: -1,
    dtype: require("./dtype"),
    dType: require("./dtype"),
    source: require("./source"),
    matchType: require("./matchType"),
    cSpace: require("./cSpace"),
    CSpace: require("./cSpace"),
    connectivity: require("./connectivity"),
    borderType: require("./borderType"),
    interpType: require("./interpType"),
    matProp: require("./matProp"),
    normType: require("./normType"),
    convMode: require("./convMode"),
    convDomain: require("./convDomain"),
    Dim4: require("./dim4"),
    Seq: require("./seq"),
    Complex: require("./complex"),
    Row: require("./row"),
    Col: require("./col"),
    Rows: require("./rows"),
    Cols: require("./cols"),
    getDevices: function() {
      var current = this.getDevice();
      try {
        var count = this.getDeviceCount();
        var result = [];
        for (var i = 0; i < count; i++) {
          this.setDevice(i);
          var info = this.deviceInfo();
          info.id = i;
          result.push(info);
        }
        return result;
      } finally {
        this.setDevice(current);
      }
    },
    gfor: require("./makeGfor")(self)
  });
}
module.exports = Ext;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUErQkE7QUFBQSxXQUFXLENBQUM7QUFFWixBQUFJLEVBQUEsQ0FBQSxRQUFPLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxVQUFTLENBQUMsQ0FBQztBQUNsQyxBQUFJLEVBQUEsQ0FBQSxDQUFBLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztBQUV6QixPQUFTLFlBQVUsQ0FBRSxJQUFHLENBQUcsQ0FBQSxDQUFBLENBQUc7QUFDMUIsT0FBTyxVQUFVLEFBQUQsQ0FBRztBQUNmLEFBQUksTUFBQSxDQUFBLEdBQUUsQ0FBQztBQUNQLEFBQUksTUFBQSxDQUFBLEdBQUUsQ0FBQztBQUNQLEFBQUksTUFBQSxDQUFBLElBQUcsRUFBSSxNQUFJLENBQUM7QUFDaEIsQUFBSSxNQUFBLENBQUEsRUFBQyxFQUFJLFVBQVUsQ0FBQSxDQUFHLENBQUEsQ0FBQSxDQUFHO0FBQ3JCLFFBQUUsRUFBSSxFQUFBLENBQUM7QUFDUCxRQUFFLEVBQUksRUFBQSxDQUFDO0FBQ1AsU0FBRyxFQUFJLEtBQUcsQ0FBQztJQUNmLENBQUM7QUFFRCxBQUFJLE1BQUEsQ0FBQSxJQUFHLEVBQUksQ0FBQSxDQUFBLFFBQVEsQUFBQyxDQUFDLFNBQVEsQ0FBQyxPQUFPLEFBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztBQUUxQyxJQUFBLE1BQU0sQUFBQyxDQUFDLElBQUcsQ0FBRyxLQUFHLENBQUMsQ0FBQztBQUVuQixVQUFPLENBQUMsSUFBRztBQUFHLFNBQUcsVUFBVSxBQUFDLEVBQUMsQ0FBQztBQUFBLEFBRTlCLE9BQUksR0FBRTtBQUFHLFVBQU0sSUFBRSxDQUFDO0FBQUEsQUFFbEIsU0FBTyxJQUFFLENBQUM7RUFDZCxDQUFDO0FBQ0w7QUFBQSxBQUVBLE9BQVMsb0JBQWtCLENBQUUsSUFBRyxDQUFHLENBQUEsR0FBRSxDQUFHLENBQUEsSUFBRztBQUN2QyxLQUFJLENBQUEsWUFBWSxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUc7QUEzRHJCLEFBQUksTUFBQSxPQUFvQixLQUFHLENBQUM7QUFDNUIsQUFBSSxNQUFBLE9BQW9CLE1BQUksQ0FBQztBQUM3QixBQUFJLE1BQUEsT0FBb0IsVUFBUSxDQUFDO0FBQ2pDLE1BQUk7QUFISixVQUFTLEdBQUEsT0FEakIsS0FBSyxFQUFBLEFBQzRCO0FBQ2hCLGVBQW9CLENBQUEsQ0EyRGIsQ0FBQSxLQUFLLEFBQUMsQ0FBQyxHQUFFLENBQUMsQ0EzRHFCLENBQ2xDLGVBQWMsV0FBVyxBQUFDLENBQUMsTUFBSyxTQUFTLENBQUMsQ0FBQyxBQUFDLEVBQUMsQ0FDckQsRUFBQyxDQUFDLE1BQW9CLENBQUEsQ0FBQyxNQUFvQixDQUFBLFNBQXFCLEFBQUMsRUFBQyxDQUFDLEtBQUssQ0FBQyxDQUN6RSxPQUFvQixLQUFHLENBQUc7VUF3RHRCLElBQUU7QUFBa0I7QUFDekIsNEJBQWtCLEFBQUMsQ0FBQyxJQUFHLENBQUcsSUFBRSxDQUFHLElBQUUsQ0FBQyxDQUFDO1FBQ3ZDO01BdkRBO0FBQUEsSUFGQSxDQUFFLFlBQTBCO0FBQzFCLFdBQW9CLEtBQUcsQ0FBQztBQUN4QixnQkFBb0MsQ0FBQztJQUN2QyxDQUFFLE9BQVE7QUFDUixRQUFJO0FBQ0YsV0FBSSxLQUFpQixHQUFLLENBQUEsV0FBdUIsR0FBSyxLQUFHLENBQUc7QUFDMUQsb0JBQXdCLEFBQUMsRUFBQyxDQUFDO1FBQzdCO0FBQUEsTUFDRixDQUFFLE9BQVE7QUFDUixnQkFBd0I7QUFDdEIsb0JBQXdCO1FBQzFCO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFBQSxBQTZDQSxVQUFNO0VBQ1Y7QUFBQSxBQUVJLElBQUEsQ0FBQSxDQUFBLEVBQUksQ0FBQSxHQUFFLENBQUUsSUFBRyxDQUFDLENBQUM7QUFDakIsS0FBSSxDQUFBLFdBQVcsQUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFHO0FBQ2pCLE9BQUksQ0FBQyxDQUFBLFdBQVcsQUFBQyxDQUFDLEdBQUUsQ0FBRSxJQUFHLEVBQUksUUFBTSxDQUFDLENBQUMsQ0FBRztBQUNwQyxRQUFFLENBQUUsSUFBRyxFQUFJLFFBQU0sQ0FBQyxFQUFJLFVBQVUsQUFBRCxDQUFHO0FBQzlCLEFBQUksVUFBQSxDQUFBLElBQUcsRUFBSSxLQUFHLENBQUM7QUFDZixBQUFJLFVBQUEsQ0FBQSxJQUFHLEVBQUksQ0FBQSxDQUFBLFFBQVEsQUFBQyxDQUFDLFNBQVEsQ0FBQyxDQUFDO0FBQy9CLGFBQU8sSUFBSSxTQUFPLEFBQUMsQ0FBQyxTQUFVLE9BQU0sQ0FBRyxDQUFBLE1BQUssQ0FBRztBQUMzQyxBQUFJLFlBQUEsQ0FBQSxFQUFDLEVBQUksVUFBVSxDQUFBLENBQUcsQ0FBQSxDQUFBLENBQUc7QUFDckIsZUFBSSxDQUFBLENBQUc7QUFDSCxtQkFBSyxBQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7WUFDYixLQUNLO0FBQ0Qsb0JBQU0sQUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO1lBQ2Q7QUFBQSxVQUNKLENBQUM7QUFDRCxhQUFHLEtBQUssQUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2IsVUFBQSxNQUFNLEFBQUMsQ0FBQyxJQUFHLENBQUcsS0FBRyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDO01BQ04sQ0FBQztJQUNMO0FBQUEsQUFDQSxNQUFFLENBQUUsSUFBRyxFQUFJLE9BQUssQ0FBQyxFQUFJLENBQUEsV0FBVSxBQUFDLENBQUMsSUFBRyxDQUFHLEVBQUEsQ0FBQyxDQUFDO0VBQzdDO0FBQUEsQUFDSjtBQUVBLE9BQVMsSUFBRSxDQUFFLElBQUcsQ0FBRztBQUVmLG9CQUFrQixBQUFDLENBQUMsSUFBRyxDQUFHLEtBQUcsQ0FBQyxDQUFDO0FBQy9CLG9CQUFrQixBQUFDLENBQUMsSUFBRyxDQUFHLENBQUEsSUFBRyxRQUFRLENBQUMsQ0FBQztBQUN2QyxvQkFBa0IsQUFBQyxDQUFDLElBQUcsQ0FBRyxDQUFBLElBQUcsUUFBUSxVQUFVLENBQUMsQ0FBQztBQUVqRCxFQUFBLE9BQU8sQUFBQyxDQUFDLElBQUcsQ0FBRztBQUNYLE1BQUUsQ0FBRyxFQUFDLENBQUE7QUFDTixPQUFHLENBQUcsS0FBRztBQUNULE1BQUUsQ0FBRyxFQUFDLENBQUE7QUFDTixRQUFJLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxTQUFRLENBQUM7QUFDeEIsUUFBSSxDQUFHLENBQUEsT0FBTSxBQUFDLENBQUMsU0FBUSxDQUFDO0FBQ3hCLFNBQUssQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLFVBQVMsQ0FBQztBQUMxQixZQUFRLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxhQUFZLENBQUM7QUFDaEMsU0FBSyxDQUFHLENBQUEsT0FBTSxBQUFDLENBQUMsVUFBUyxDQUFDO0FBQzFCLFNBQUssQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLFVBQVMsQ0FBQztBQUMxQixlQUFXLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxnQkFBZSxDQUFDO0FBQ3RDLGFBQVMsQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLGNBQWEsQ0FBQztBQUNsQyxhQUFTLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxjQUFhLENBQUM7QUFDbEMsVUFBTSxDQUFHLENBQUEsT0FBTSxBQUFDLENBQUMsV0FBVSxDQUFDO0FBQzVCLFdBQU8sQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLFlBQVcsQ0FBQztBQUM5QixXQUFPLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxZQUFXLENBQUM7QUFDOUIsYUFBUyxDQUFHLENBQUEsT0FBTSxBQUFDLENBQUMsY0FBYSxDQUFDO0FBQ2xDLE9BQUcsQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLFFBQU8sQ0FBQztBQUN0QixNQUFFLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxPQUFNLENBQUM7QUFDcEIsVUFBTSxDQUFHLENBQUEsT0FBTSxBQUFDLENBQUMsV0FBVSxDQUFDO0FBQzVCLE1BQUUsQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLE9BQU0sQ0FBQztBQUNwQixNQUFFLENBQUcsQ0FBQSxPQUFNLEFBQUMsQ0FBQyxPQUFNLENBQUM7QUFDcEIsT0FBRyxDQUFHLENBQUEsT0FBTSxBQUFDLENBQUMsUUFBTyxDQUFDO0FBQ3RCLE9BQUcsQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLFFBQU8sQ0FBQztBQUN0QixhQUFTLENBQUcsVUFBVSxBQUFELENBQUc7QUFDcEIsQUFBSSxRQUFBLENBQUEsT0FBTSxFQUFJLENBQUEsSUFBRyxVQUFVLEFBQUMsRUFBQyxDQUFDO0FBQzlCLFFBQUk7QUFDQSxBQUFJLFVBQUEsQ0FBQSxLQUFJLEVBQUksQ0FBQSxJQUFHLGVBQWUsQUFBQyxFQUFDLENBQUM7QUFDakMsQUFBSSxVQUFBLENBQUEsTUFBSyxFQUFJLEdBQUMsQ0FBQztBQUNmLG1CQUFhLEVBQUEsQ0FBRyxDQUFBLENBQUEsRUFBSSxNQUFJLENBQUcsQ0FBQSxDQUFBLEVBQUUsQ0FBRztBQUM1QixhQUFHLFVBQVUsQUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0FBQ2pCLEFBQUksWUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLElBQUcsV0FBVyxBQUFDLEVBQUMsQ0FBQztBQUM1QixhQUFHLEdBQUcsRUFBSSxFQUFBLENBQUM7QUFDWCxlQUFLLEtBQUssQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDO1FBQ3JCO0FBQUEsQUFDQSxhQUFPLE9BQUssQ0FBQztNQUNqQixDQUNBLE9BQVE7QUFDSixXQUFHLFVBQVUsQUFBQyxDQUFDLE9BQU0sQ0FBQyxDQUFDO01BQzNCO0FBQUEsSUFDSjtBQUNBLE9BQUcsQ0FBRyxDQUFBLE9BQU0sQUFBQyxDQUFDLFlBQVcsQ0FBQyxBQUFDLENBQUMsSUFBRyxDQUFDO0FBQUEsRUFDcEMsQ0FBQyxDQUFDO0FBQ047QUFBQSxBQUVBLEtBQUssUUFBUSxFQUFJLElBQUUsQ0FBQztBQUFBIiwiZmlsZSI6ImV4dC5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAoYykgMjAxNC0yMDE1LCBBcnJheUZpcmVcbkNvcHlyaWdodCAoYykgMjAxNSBHw6Fib3IgTWV6xZEgYWthIHVuYm9ybmNoaWtrZW4gKGdhYm9yLm1lem9Ab3V0bG9vay5jb20pXG5BbGwgcmlnaHRzIHJlc2VydmVkLlxuXG5SZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLFxuYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuXG4gKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXNcbiAgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG5cbiAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpc1xuICBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3JcbiAgb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cblxuICogTmVpdGhlciB0aGUgbmFtZSBvZiB0aGUgQXJyYXlGaXJlIG5vciB0aGUgbmFtZXMgb2YgaXRzXG4gIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tXG4gIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG5cblRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbldBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbkRJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SXG5BTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbihJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbkxPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTlxuQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbihJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG5TT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiovXG5cblwidXNlIHN0cmljdFwiO1xuXG5sZXQgQmx1ZWJpcmQgPSByZXF1aXJlKFwiYmx1ZWJpcmRcIik7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5cbmZ1bmN0aW9uIHN5bmNocm9uaWZ5KGZpcmUsIGYpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXJyO1xuICAgICAgICB2YXIgcmVzO1xuICAgICAgICB2YXIgZG9uZSA9IGZhbHNlO1xuICAgICAgICBsZXQgY2IgPSBmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICAgICAgZXJyID0gZTtcbiAgICAgICAgICAgIHJlcyA9IHI7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgYXJncyA9IF8udG9BcnJheShhcmd1bWVudHMpLmNvbmNhdChjYik7XG5cbiAgICAgICAgZi5hcHBseSh0aGlzLCBhcmdzKTtcblxuICAgICAgICB3aGlsZSAoIWRvbmUpIGZpcmUuX2RvRXZlbnRzKCk7XG5cbiAgICAgICAgaWYgKGVycikgdGhyb3cgZXJyO1xuXG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gaW5zdGFsbEFzeW5jQW5kU3luYyhmaXJlLCBvYmosIG5hbWUpIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChuYW1lKSkge1xuICAgICAgICBmb3IgKGxldCBrZXkgb2YgXy5rZXlzKG9iaikpIHtcbiAgICAgICAgICAgIGluc3RhbGxBc3luY0FuZFN5bmMoZmlyZSwgb2JqLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZiA9IG9ialtuYW1lXTtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKGYpKSB7XG4gICAgICAgIGlmICghXy5pc0Z1bmN0aW9uKG9ialtuYW1lICsgXCJBc3luY1wiXSkpIHtcbiAgICAgICAgICAgIG9ialtuYW1lICsgXCJBc3luY1wiXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgbGV0IGFyZ3MgPSBfLnRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsdWViaXJkKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNiID0gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGNiKTtcbiAgICAgICAgICAgICAgICAgICAgZi5hcHBseShzZWxmLCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgb2JqW25hbWUgKyBcIlN5bmNcIl0gPSBzeW5jaHJvbmlmeShmaXJlLCBmKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIEV4dChzZWxmKSB7XG5cbiAgICBpbnN0YWxsQXN5bmNBbmRTeW5jKHNlbGYsIHNlbGYpO1xuICAgIGluc3RhbGxBc3luY0FuZFN5bmMoc2VsZiwgc2VsZi5BRkFycmF5KTtcbiAgICBpbnN0YWxsQXN5bmNBbmRTeW5jKHNlbGYsIHNlbGYuQUZBcnJheS5wcm90b3R5cGUpO1xuXG4gICAgXy5leHRlbmQoc2VsZiwge1xuICAgICAgICBlbmQ6IC0xLFxuICAgICAgICBzcGFuOiBudWxsLFxuICAgICAgICBhbGw6IC0xLFxuICAgICAgICBkdHlwZTogcmVxdWlyZShcIi4vZHR5cGVcIiksXG4gICAgICAgIGRUeXBlOiByZXF1aXJlKFwiLi9kdHlwZVwiKSxcbiAgICAgICAgc291cmNlOiByZXF1aXJlKFwiLi9zb3VyY2VcIiksXG4gICAgICAgIG1hdGNoVHlwZTogcmVxdWlyZShcIi4vbWF0Y2hUeXBlXCIpLFxuICAgICAgICBjU3BhY2U6IHJlcXVpcmUoXCIuL2NTcGFjZVwiKSxcbiAgICAgICAgQ1NwYWNlOiByZXF1aXJlKFwiLi9jU3BhY2VcIiksXG4gICAgICAgIGNvbm5lY3Rpdml0eTogcmVxdWlyZShcIi4vY29ubmVjdGl2aXR5XCIpLFxuICAgICAgICBib3JkZXJUeXBlOiByZXF1aXJlKFwiLi9ib3JkZXJUeXBlXCIpLFxuICAgICAgICBpbnRlcnBUeXBlOiByZXF1aXJlKFwiLi9pbnRlcnBUeXBlXCIpLFxuICAgICAgICBtYXRQcm9wOiByZXF1aXJlKFwiLi9tYXRQcm9wXCIpLFxuICAgICAgICBub3JtVHlwZTogcmVxdWlyZShcIi4vbm9ybVR5cGVcIiksXG4gICAgICAgIGNvbnZNb2RlOiByZXF1aXJlKFwiLi9jb252TW9kZVwiKSxcbiAgICAgICAgY29udkRvbWFpbjogcmVxdWlyZShcIi4vY29udkRvbWFpblwiKSxcbiAgICAgICAgRGltNDogcmVxdWlyZShcIi4vZGltNFwiKSxcbiAgICAgICAgU2VxOiByZXF1aXJlKFwiLi9zZXFcIiksXG4gICAgICAgIENvbXBsZXg6IHJlcXVpcmUoXCIuL2NvbXBsZXhcIiksXG4gICAgICAgIFJvdzogcmVxdWlyZShcIi4vcm93XCIpLFxuICAgICAgICBDb2w6IHJlcXVpcmUoXCIuL2NvbFwiKSxcbiAgICAgICAgUm93czogcmVxdWlyZShcIi4vcm93c1wiKSxcbiAgICAgICAgQ29sczogcmVxdWlyZShcIi4vY29sc1wiKSxcbiAgICAgICAgZ2V0RGV2aWNlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSB0aGlzLmdldERldmljZSgpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSB0aGlzLmdldERldmljZUNvdW50KCk7XG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERldmljZShpKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGluZm8gPSB0aGlzLmRldmljZUluZm8oKTtcbiAgICAgICAgICAgICAgICAgICAgaW5mby5pZCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXREZXZpY2UoY3VycmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdmb3I6IHJlcXVpcmUoXCIuL21ha2VHZm9yXCIpKHNlbGYpXG4gICAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRXh0OyJdfQ==
