{"version":3,"sources":["machine-learning/neuralNetwork.js"],"names":[],"mappings":"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","file":"machine-learning/neuralNetwork.js","sourcesContent":["\"use strict\";\n\nlet Bluebird = require(\"bluebird\");\nlet async = Bluebird.coroutine;\nlet common = require(\"../common\");\nlet mnist = require(\"./mnist\");\nlet ANN = require(\"./ann\");\nlet now = require(\"performance-now\");\n\nlet accuracy = async(function*(af, predicted, target) {\n    let pMax = yield af.findMaxAtAsync(predicted, 1);\n    let tMax = yield af.findMaxAtAsync(target, 1);\n    return (100 * (yield af.countAsync(pMax.index.eq(tMax.index)))) / tMax.index.elements();\n});\n\nlet annDemo = async(function*(af, deviceInfo) {\n    console.log(\"Running ANN Demo on device:\\n\");\n    common.printDeviceInfo(deviceInfo);\n    console.log(\"\");\n\n    console.log(\"Setting up training data.\");\n    let data = yield mnist.setup(af, true, 0.6);\n\n    let featureSize = data.trainImages.elements() / data.numTrain;\n\n    // Reshape images into feature vectors\n    let trainFeats = af.transpose(af.modDims(data.trainImages, featureSize, data.numTrain));\n    let testFeats = af.transpose(af.modDims(data.testImages, featureSize, data.numTest));\n\n    let trainTarget = af.transpose(data.trainLabels);\n    let testTarget = af.transpose(data.testLabels);\n\n    let network = new ANN(af, [trainFeats.dims(1), 100, 50, data.numClasses]);\n\n    // Train network\n    const start = now();\n    yield network.train(\n        trainFeats,\n        trainTarget,\n        {\n            alpha: 1.0,\n            maxEpochs: 300,\n            batchSize: 100,\n            maxError: 1.0\n        }\n    );\n    yield af.waitAsync();\n    const end = now();\n\n    // Run the trained network and test accuracy.\n    let trainOutput = network.predict(trainFeats);\n    let testOutput = network.predict(testFeats);\n\n    console.log(\"Training set:\");\n    console.log(`Accuracy on training data: ${(yield accuracy(af, trainOutput, trainTarget)).toFixed(2)}`);\n\n    console.log(\"Test set:\");\n    console.log(`Accuracy on testing  data: ${(yield accuracy(af, testOutput, testTarget)).toFixed(2)}`);\n\n    console.log(`Training time: ${((end - start) / 1000).toFixed(10)} seconds\\n`);\n});\n\ncommon.runOnBestDevice(annDemo, \"ANN Demo\");"],"sourceRoot":"/source/"}